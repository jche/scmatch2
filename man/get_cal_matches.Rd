% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/get_cal_matches.R
\name{get_cal_matches}
\alias{get_cal_matches}
\title{Caliper Synthetic Matching}
\usage{
get_cal_matches(
  data,
  form = NULL,
  covs = NULL,
  treatment = NULL,
  metric = c("maximum", "euclidean", "manhattan"),
  caliper = 1,
  rad_method = c("adaptive", "fixed", "1nn", "knn"),
  est_method = c("scm", "scm_extrap", "average"),
  scaling = NULL,
  id_name = "id",
  warn = TRUE,
  k = 1,
  dm = NULL
)
}
\arguments{
\item{data}{The data frame of data to be matched. Must contain
treatment indicator and covariates for matching.}

\item{form}{Formula of form treatment ~ cov1 + cov2 + ...
specifying the treatment variable and covariates to use for
matching.  If not null, will override covs and treatment.}

\item{covs}{Specification of covariates to use for matching. Can be
variable names, list of column numbers, or NULL.  If NULL, will
use covariate names found in the scaling parameter, or default to
all columns starting with "X".}

\item{treatment}{Name of the column in \code{data} containing the
treatment indicator (with values 0/1 or TRUE/FALSE).}

\item{metric}{Distance metric: "maximum", "euclidean", or
"manhattan".}

\item{caliper}{Caliper size. Sets the max allowed distance between
matches. Often 1. Scaling usually handles covariate importance.}

\item{rad_method}{How to set the radius for each treated unit:
\itemize{
\item "adaptive": max(caliper, distance to nearest control)
\item "fixed": use caliper; drop treated with no controls inside it
\item "1nn": distance to nearest neighbor
\item "adaptive-5nn": adaptive with cap at 5th NN
\item "knn": distance to the k-th nearest neighbor
}}

\item{est_method}{How to weight control units:
\itemize{
\item "scm": synthetic control weights
\item "scm_extrap": SCM with extrapolation
\item "average": simple average
}}

\item{scaling}{Length-P vector of scaling constants (or a
single-row data frame). Each covariate is scaled by its value.
Often 1/sd. Defaults to 1. If covs not supplied, the argument
name is used to identify covariates.}

\item{id_name}{Column name for unit IDs. If missing, an \code{id}
column using row numbers is created.}

\item{warn}{A logical indicating whether to warn about dropped
units (those that cannot be matched within the caliper).}

\item{k}{Integer specifying the number of neighbors to use when
\code{rad_method = "knn"}.}

\item{dm}{Optional treated-control distance matrix. Calipers are
applied but distances are not recomputed.}
}
\value{
An S3 object of class "csm_matches" containing:
\itemize{
\item \code{matches}: A list of data frames, each containing matched control units for a treated unit
\item \code{adacalipers}: Vector of adaptive calipers for each treated unit
\item \code{dm_trimmed}: Distance matrix with control units farther than caliper set to NA
\item \code{dm_uncapped}: Original distance matrix without censoring
\item \code{treatment_table}: Table of treated units with matching information
}
The object also has attributes storing the settings used for
matching.
}
\description{
This is the core method of the CSM package. Conduct (adaptive)
radius matching with optional synthetic step on the resulting sets
of controls. The function creates a matched dataset by finding
control units that are similar to treatment units based on
specified covariates and distance metrics, then optionally weights
these controls using synthetic control methods.
}
\examples{
# Generate example data
set.seed(4044440)
dat <- gen_one_toy(nt = 5)

# Perform matching
mtch <- get_cal_matches(dat,
                        metric = "maximum",
                        scaling = c(1/0.2, 1/0.2),
                        caliper = 1,
                        rad_method = "adaptive",
                        est_method = "scm")

# View matching results
mtch

# Convert to data frame
as.data.frame(mtch)

}
\seealso{
\code{\link{gen_matches}} for the underlying matching
function, \code{\link{est_weights}} for weight calculation,
\code{\link{result_table}} for extracting results
}
